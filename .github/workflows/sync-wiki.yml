name: åŒæ­¥ Wiki åˆ° GitHub Wiki

on:
  push:
    branches: [main]
    paths: ["wiki/**"]
  workflow_dispatch:

jobs:
  sync-wiki:
    runs-on: ubuntu-latest
    steps:
      - name: æª¢å‡ºä¸»å€‰åº«
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: æª¢å‡º Wiki å€‰åº«
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository }}.wiki
          path: wiki-repo
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: åŒæ­¥ Wiki æ–‡ä»¶
        run: |
          # è¤‡è£½ API æ–‡æª”åˆ° Wiki å€‰åº«
          cp wiki/API-Documentation.md wiki-repo/API-Documentation.md

          # å‰µå»º Wiki é¦–é 
          cat > wiki-repo/Home.md << 'EOF'
          # ProxyHunter Wiki

          æ­¡è¿Žä¾†åˆ° ProxyHunter çš„å®˜æ–¹ Wikiï¼

          ## ðŸ“š æ–‡æª”ç›®éŒ„

          ### API æ–‡æª”
          - [API Documentation](API-Documentation) - å®Œæ•´çš„ API æ–‡æª”ï¼ˆè‹±æ–‡ & ç¹é«”ä¸­æ–‡ï¼‰

          ### å¿«é€Ÿé–‹å§‹
          è©³ç´°çš„å®‰è£å’Œä½¿ç”¨èªªæ˜Žè«‹åƒè€ƒ [README.md](https://github.com/sheng1111/Proxy-Hunter/blob/main/README.md)

          ### é …ç›®è³‡è¨Š
          - **GitHub**: https://github.com/sheng1111/Proxy-Hunter
          - **PyPI**: https://pypi.org/project/proxy-meshx/
          - **ç‰ˆæœ¬**: 2.3.0

          ---

          ## ðŸ”— å¿«é€Ÿé€£çµ

          - [å¿«é€Ÿå®‰è£](https://github.com/sheng1111/Proxy-Hunter#-quick-start)
          - [Web ç•Œé¢](https://github.com/sheng1111/Proxy-Hunter#-enhanced-web-dashboard)
          - [å•é¡Œå›žå ±](https://github.com/sheng1111/Proxy-Hunter/issues)

          Made with â¤ï¸ for the security community
          EOF

      - name: æäº¤ä¸¦æŽ¨é€åˆ° Wiki
        run: |
          cd wiki-repo
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          if ! git diff --cached --quiet; then
            git commit -m "ðŸ“š è‡ªå‹•åŒæ­¥ Wiki æ–‡æª” - $(date '+%Y-%m-%d %H:%M:%S')"
            git push
          else
            echo "æ²’æœ‰è®Šæ›´éœ€è¦åŒæ­¥"
          fi
